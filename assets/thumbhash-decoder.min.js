/**
 * ThumbHash decoder for AVIF Local Support plugin.
 * Decodes ThumbHash strings to data URLs for LQIP (Low Quality Image Placeholders).
 * 
 * Based on the reference implementation from https://github.com/evanw/thumbhash
 * @license MIT
 */
!function(){"use strict";var t,e,a=document,r=Math,n=r.PI,o=r.cos,i=r.round,c=r.max,d=r.min,s={},u=Date.now();function h(r){if(s[r])return s[r];try{var u=function(t){var e,a=atob(t),r=a.length,s=new Uint8Array(r);for(e=0;e<r;e++)s[e]=a.charCodeAt(e);var u=s[0]|s[1]<<8|s[2]<<16,h=s[3]|s[4]<<8,f=(63&u)/63,l=(u>>6&63)/31.5-1,g=(u>>12&63)/31.5-1,v=(u>>18&31)/31,m=!!(u>>23),b=(h>>3&63)/63,y=(h>>9&63)/63,L=!!(h>>15),p=c(3,L?m?5:7:7&h),k=c(3,L?7&h:m?5:7),w=1,E=0,I=5,A=0;function D(t,e,a){var r,n,o,i=[];for(r=0;r<e;r++)for(n=r?0:1;n*e<t*(e-r);n++)o=1&A?s[I+(A>>1)]>>4:15&s[I+(A>>1)],i.push((o/7.5-1)*a),A++;return i}m&&(w=(15&s[5])/15,E=(s[5]>>4&15)/15,I=6);var C,P,R,S,U,M,N,T,q,x,z,O,_,G,W,j,B,F=D(p,k,v),H=D(3,3,1.25*b),J=D(3,3,1.25*y),K=m?D(5,5,E):null,Q=!!((s[0]|s[1]<<8|s[2]<<16)>>23&1),V=!!((s[3]|s[4]<<8)>>15&1),X=V?Q?5:7:7&(s[3]|s[4]<<8>>8),Y=V?7&(s[3]|s[4]<<8>>8):Q?5:7,Z=(V?32:X)/(V?Y:32),$=i(Z>1?32:32*Z),tt=i(Z>1?32/Z:32),et=new Uint8Array($*tt*4),at=n/tt,rt=n/$;for(P=0;P<tt;P++){var nt=P+.5;for(x=[],e=0;e<k;e++)x[e]=o(at*nt*e);if(z=[o(0),o(at*nt),o(at*nt*2)],m)for(O=[],e=0;e<5;e++)O[e]=o(at*nt*e);for(C=0;C<$;C++){var ot=C+.5;R=f,S=l,U=g,M=w;var it=[],ct=c(p,m?5:3);for(e=0;e<ct;e++)it[e]=o(rt*ot*e);for(N=0,q=0;q<k;q++){var dt=2*x[q];for(T=q?0:1;T*k<p*(k-q);T++,N++)R+=F[N]*it[T]*dt}for(N=0,q=0;q<3;q++){var st=2*z[q];for(T=q?0:1;T<3-q;T++,N++){var ut=it[T]*st;S+=H[N]*ut,U+=J[N]*ut}}if(m)for(N=0,q=0;q<5;q++){var ht=2*O[q];for(T=q?0:1;T<5-q;T++,N++)M+=K[N]*it[T]*ht}j=(W=(3*R-(G=R-2/3*S)+U)/2)-U,B=G,et[_=4*(P*$+C)]=c(0,d(255,i(255*W))),et[_+1]=c(0,d(255,i(255*j))),et[_+2]=c(0,d(255,i(255*B))),et[_+3]=c(0,d(255,i(255*M)))}}return{w:$,h:tt,rgba:et}}(r);t||(t=a.createElement("canvas"),e=t.getContext("2d")),t.width=u.w,t.height=u.h;var h=e.createImageData(u.w,u.h);return h.data.set(u.rgba),e.putImageData(h,0,0),s[r]=t.toDataURL()}catch(t){return""}}function f(t){if(!t._th){t._th=1;var e=t.getAttribute("data-thumbhash");if(e){var a=h(e);if(a){var r=t.closest("picture")||t,n=r.style;n.backgroundImage="url("+a+")",n.backgroundSize="cover",n.backgroundPosition="center",n.backgroundRepeat="no-repeat","PICTURE"===r.tagName&&(n.display="block"),t.complete&&t.naturalWidth?o():(r.classList&&r.classList.add("thumbhash-loading"),t.addEventListener("load",function(){Date.now()-u<2e3?c():t.decode?t.decode().then(i).catch(i):i()},{once:!0}),t.addEventListener("error",c,{once:!0}))}}}function o(){n.backgroundImage=n.backgroundSize=n.backgroundPosition=n.backgroundRepeat="","PICTURE"===r.tagName&&(n.display="")}function i(){r.classList&&r.classList.remove("thumbhash-loading"),setTimeout(o,420)}function c(){t.style.transition="none",r.classList&&r.classList.remove("thumbhash-loading"),o()}}function l(t){if(t&&(1===t.nodeType&&"IMG"===t.tagName&&t.hasAttribute("data-thumbhash")&&f(t),t.querySelectorAll)){var e,a=t.querySelectorAll("img[data-thumbhash]");for(e=0;e<a.length;e++)f(a[e])}}new MutationObserver(function(t){for(var e=0;e<t.length;e++)for(var a=t[e].addedNodes,r=0;r<a.length;r++)l(a[r])}).observe(a.documentElement,{childList:!0,subtree:!0}),"loading"!==a.readyState?l(a.body||a.documentElement):a.addEventListener("DOMContentLoaded",function(){l(a.body)})}();