/**
 * ThumbHash decoder for AVIF Local Support plugin.
 * Decodes ThumbHash strings to data URLs for LQIP (Low Quality Image Placeholders).
 * 
 * Based on the reference implementation from https://github.com/evanw/thumbhash
 * @license MIT
 */
!function(){"use strict";var t,e,a=document,r=Math,n=r.PI,o=r.cos,i=r.round,c=r.max,d=r.min,s={},u=Date.now();function h(r){if(s[r])return s[r];try{var u=function(t){var e,a=atob(t),r=a.length,s=new Uint8Array(r);for(e=0;e<r;e++)s[e]=a.charCodeAt(e);var u=s[0]|s[1]<<8|s[2]<<16,h=s[3]|s[4]<<8,f=(63&u)/63,l=(u>>6&63)/31.5-1,v=(u>>12&63)/31.5-1,g=(u>>18&31)/31,m=!!(u>>23),b=(h>>3&63)/63,L=(h>>9&63)/63,w=!!(h>>15),y=c(3,w?m?5:7:7&h),p=c(3,w?7&h:m?5:7),D=1,A=0,E=5,I=0;function k(t,e,a){var r,n,o,i=[];for(r=0;r<e;r++)for(n=r?0:1;n*e<t*(e-r);n++)o=1&I?s[E+(I>>1)]>>4:15&s[E+(I>>1)],i.push((o/7.5-1)*a),I++;return i}m&&(D=(15&s[5])/15,A=(s[5]>>4&15)/15,E=6);var C,M,S,U,N,P,R,q,x,O,T,_,z,G,W,j,B,F=k(y,p,g),H=k(3,3,1.25*b),J=k(3,3,1.25*L),K=m?k(5,5,A):null,Q=!!((s[0]|s[1]<<8|s[2]<<16)>>23&1),V=!!((s[3]|s[4]<<8)>>15&1),X=V?Q?5:7:7&(s[3]|s[4]<<8>>8),Y=V?7&(s[3]|s[4]<<8>>8):Q?5:7,Z=(V?32:X)/(V?Y:32),$=i(Z>1?32:32*Z),tt=i(Z>1?32/Z:32),et=new Uint8Array($*tt*4),at=n/tt,rt=n/$;for(M=0;M<tt;M++){var nt=M+.5;for(O=[],e=0;e<p;e++)O[e]=o(at*nt*e);if(T=[o(0),o(at*nt),o(at*nt*2)],m)for(_=[],e=0;e<5;e++)_[e]=o(at*nt*e);for(C=0;C<$;C++){var ot=C+.5;S=f,U=l,N=v,P=D;var it=[],ct=c(y,m?5:3);for(e=0;e<ct;e++)it[e]=o(rt*ot*e);for(R=0,x=0;x<p;x++){var dt=2*O[x];for(q=x?0:1;q*p<y*(p-x);q++,R++)S+=F[R]*it[q]*dt}for(R=0,x=0;x<3;x++){var st=2*T[x];for(q=x?0:1;q<3-x;q++,R++){var ut=it[q]*st;U+=H[R]*ut,N+=J[R]*ut}}if(m)for(R=0,x=0;x<5;x++){var ht=2*_[x];for(q=x?0:1;q<5-x;q++,R++)P+=K[R]*it[q]*ht}j=(W=(3*S-(G=S-2/3*U)+N)/2)-N,B=G,et[z=4*(M*$+C)]=c(0,d(255,i(255*W))),et[z+1]=c(0,d(255,i(255*j))),et[z+2]=c(0,d(255,i(255*B))),et[z+3]=c(0,d(255,i(255*P)))}}return{w:$,h:tt,rgba:et}}(r);t||(t=a.createElement("canvas"),e=t.getContext("2d")),t.width=u.w,t.height=u.h;var h=e.createImageData(u.w,u.h);return h.data.set(u.rgba),e.putImageData(h,0,0),s[r]=t.toDataURL()}catch(t){return""}}function f(t){if(!t._th){t._th=1;var e=t.getAttribute("data-thumbhash");if(e){var a=h(e);if(a){var r=t.closest("picture")||t,n=r.style,o=Date.now();n.backgroundImage="url("+a+")",n.backgroundSize="cover",n.backgroundPosition="center",n.backgroundRepeat="no-repeat","PICTURE"===r.tagName&&(n.display="block"),r.classList&&r.classList.add("thumbhash-loading"),t.complete&&t.naturalWidth?c():(t.addEventListener("load",function(){var e=Date.now()-u,a=Date.now()-o;e<1e3||a<50?c():t.decode?t.decode().then(i).catch(i):i()},{once:!0}),t.addEventListener("error",c,{once:!0}))}}}function i(){r.classList&&r.classList.remove("thumbhash-loading")}function c(){r.classList&&r.classList.remove("thumbhash-loading")}}function l(t){if(t&&(1===t.nodeType&&"IMG"===t.tagName&&t.hasAttribute("data-thumbhash")&&f(t),t.querySelectorAll)){var e,a=t.querySelectorAll("img[data-thumbhash]");for(e=0;e<a.length;e++)f(a[e])}}new MutationObserver(function(t){for(var e=0;e<t.length;e++)for(var a=t[e].addedNodes,r=0;r<a.length;r++)l(a[r])}).observe(a.documentElement,{childList:!0,subtree:!0}),"loading"!==a.readyState?l(a.body||a.documentElement):a.addEventListener("DOMContentLoaded",function(){l(a.body)})}();