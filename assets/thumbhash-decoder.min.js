/**
 * ThumbHash decoder for AVIF Local Support plugin.
 * Decodes ThumbHash strings to data URLs for LQIP (Low Quality Image Placeholders).
 * 
 * Based on the reference implementation from https://github.com/evanw/thumbhash
 * @license MIT
 */
!function(){"use strict";var t,e,a=document,r=Math,n=r.PI,o=r.cos,i=r.round,c=r.max,d=r.min,u={},s=Date.now();function h(r){if(u[r])return u[r];try{var s=function(t){var e,a=atob(t),r=a.length,u=new Uint8Array(r);for(e=0;e<r;e++)u[e]=a.charCodeAt(e);var s=u[0]|u[1]<<8|u[2]<<16,h=u[3]|u[4]<<8,f=(63&s)/63,l=(s>>6&63)/31.5-1,v=(s>>12&63)/31.5-1,g=(s>>18&31)/31,b=!!(s>>23),m=(h>>3&63)/63,y=(h>>9&63)/63,L=!!(h>>15),w=c(3,L?b?5:7:7&h),k=c(3,L?7&h:b?5:7),p=1,D=0,A=5,E=0;function I(t,e,a){var r,n,o,i=[];for(r=0;r<e;r++)for(n=r?0:1;n*e<t*(e-r);n++)o=1&E?u[A+(E>>1)]>>4:15&u[A+(E>>1)],i.push((o/7.5-1)*a),E++;return i}b&&(p=(15&u[5])/15,D=(u[5]>>4&15)/15,A=6);var S,C,M,P,R,U,N,T,q,x,z,O,_,G,W,j,B,F=I(w,k,g),H=I(3,3,1.25*m),J=I(3,3,1.25*y),K=b?I(5,5,D):null,Q=!!((u[0]|u[1]<<8|u[2]<<16)>>23&1),V=!!((u[3]|u[4]<<8)>>15&1),X=V?Q?5:7:7&(u[3]|u[4]<<8>>8),Y=V?7&(u[3]|u[4]<<8>>8):Q?5:7,Z=(V?32:X)/(V?Y:32),$=i(Z>1?32:32*Z),tt=i(Z>1?32/Z:32),et=new Uint8Array($*tt*4),at=n/tt,rt=n/$;for(C=0;C<tt;C++){var nt=C+.5;for(x=[],e=0;e<k;e++)x[e]=o(at*nt*e);if(z=[o(0),o(at*nt),o(at*nt*2)],b)for(O=[],e=0;e<5;e++)O[e]=o(at*nt*e);for(S=0;S<$;S++){var ot=S+.5;M=f,P=l,R=v,U=p;var it=[],ct=c(w,b?5:3);for(e=0;e<ct;e++)it[e]=o(rt*ot*e);for(N=0,q=0;q<k;q++){var dt=2*x[q];for(T=q?0:1;T*k<w*(k-q);T++,N++)M+=F[N]*it[T]*dt}for(N=0,q=0;q<3;q++){var ut=2*z[q];for(T=q?0:1;T<3-q;T++,N++){var st=it[T]*ut;P+=H[N]*st,R+=J[N]*st}}if(b)for(N=0,q=0;q<5;q++){var ht=2*O[q];for(T=q?0:1;T<5-q;T++,N++)U+=K[N]*it[T]*ht}j=(W=(3*M-(G=M-2/3*P)+R)/2)-R,B=G,et[_=4*(C*$+S)]=c(0,d(255,i(255*W))),et[_+1]=c(0,d(255,i(255*j))),et[_+2]=c(0,d(255,i(255*B))),et[_+3]=c(0,d(255,i(255*U)))}}return{w:$,h:tt,rgba:et}}(r);t||(t=a.createElement("canvas"),e=t.getContext("2d")),t.width=s.w,t.height=s.h;var h=e.createImageData(s.w,s.h);return h.data.set(s.rgba),e.putImageData(h,0,0),u[r]=t.toDataURL()}catch(t){return""}}function f(t){if(!t._th){t._th=1;var e=t.getAttribute("data-thumbhash");if(e){var a=h(e);if(a){var r=t.closest("picture")||t,n=r.style,o=Date.now();n.backgroundImage="url("+a+")",n.backgroundSize="cover",n.backgroundPosition="center",n.backgroundRepeat="no-repeat","PICTURE"===r.tagName&&(n.display="block"),t.complete&&t.naturalWidth||(r.classList&&r.classList.add("thumbhash-loading"),t.addEventListener("load",function(){var e=Date.now()-s,a=Date.now()-o;e<2e3||a<200?d():t.decode?t.decode().then(c).catch(c):c()},{once:!0}),t.addEventListener("error",d,{once:!0}))}}}function i(){n.backgroundImage=n.backgroundSize=n.backgroundPosition=n.backgroundRepeat=""}function c(){r.classList&&r.classList.remove("thumbhash-loading"),setTimeout(i,450)}function d(){r.style.transition="none",r.classList&&r.classList.remove("thumbhash-loading"),i()}}function l(t){if(t&&(1===t.nodeType&&"IMG"===t.tagName&&t.hasAttribute("data-thumbhash")&&f(t),t.querySelectorAll)){var e,a=t.querySelectorAll("img[data-thumbhash]");for(e=0;e<a.length;e++)f(a[e])}}new MutationObserver(function(t){for(var e=0;e<t.length;e++)for(var a=t[e].addedNodes,r=0;r<a.length;r++)l(a[r])}).observe(a.documentElement,{childList:!0,subtree:!0}),"loading"!==a.readyState?l(a.body||a.documentElement):a.addEventListener("DOMContentLoaded",function(){l(a.body)})}();