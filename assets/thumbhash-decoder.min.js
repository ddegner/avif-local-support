/**
 * ThumbHash decoder for AVIF Local Support plugin.
 * Decodes ThumbHash strings to data URLs for LQIP (Low Quality Image Placeholders).
 * 
 * Based on the reference implementation from https://github.com/evanw/thumbhash
 * @license MIT
 */
!function(){"use strict";var t,e,a=document,r=Math,n=r.PI,o=r.cos,i=r.round,d=r.max,u=r.min,c={};function s(r){if(c[r])return c[r];try{var s=function(t){var e,a=atob(t),r=a.length,c=new Uint8Array(r);for(e=0;e<r;e++)c[e]=a.charCodeAt(e);var s=c[0]|c[1]<<8|c[2]<<16,h=c[3]|c[4]<<8,f=(63&s)/63,l=(s>>6&63)/31.5-1,g=(s>>12&63)/31.5-1,b=(s>>18&31)/31,v=!!(s>>23),m=(h>>3&63)/63,y=(h>>9&63)/63,L=!!(h>>15),k=d(3,L?v?5:7:7&h),p=d(3,L?7&h:v?5:7),w=1,A=0,E=5,I=0;function S(t,e,a){var r,n,o,i=[];for(r=0;r<e;r++)for(n=0;n<t;n++)(n||r)&&(o=1&I?c[E+(I>>1)]>>4:15&c[E+(I>>1)],i.push((o/7.5-1)*a),I++);return i}v&&(w=(15&c[5])/15,A=(c[5]>>4&15)/15,E=6);var C,D,M,P,R,U,N,q,x,z,O,T,_,G,W,j,B,F,H,J=S(k,p,b),K=S(3,3,1.25*m),Q=S(3,3,1.25*y),V=v?S(5,5,A):null,X=!!((c[0]|c[1]<<8|c[2]<<16)>>23&1),Y=!!((c[3]|c[4]<<8)>>15&1),Z=Y?X?5:7:7&(c[3]|c[4]<<8>>8),$=Y?7&(c[3]|c[4]<<8>>8):X?5:7,tt=(Y?32:Z)/(Y?$:32),et=i(tt>1?32:32*tt),at=i(tt>1?32/tt:32),rt=new Uint8Array(et*at*4),nt=n/at,ot=n/et;for(D=0;D<at;D++){var it=D+.5;for(T=[],e=0;e<p;e++)T[e]=o(nt*it*e);if(_=[o(0),o(nt*it),o(nt*it*2)],v)for(G=[],e=0;e<5;e++)G[e]=o(nt*it*e);for(C=0;C<et;C++){var dt=C+.5;for(M=f,P=l,R=g,U=w,N=0,x=0;x<p;x++)for(O=T[x],q=0;q<k;q++)(q||x)&&(M+=J[N++]*o(ot*dt*q)*O);for(N=0,x=0;x<3;x++)for(q=0;q<3;q++)(q||x)&&(z=o(ot*dt*q),P+=K[N]*z*_[x],R+=Q[N]*z*_[x],N++);if(v)for(N=0,x=0;x<5;x++)for(q=0;q<5;q++)(q||x)&&(U+=V[N++]*o(ot*dt*q)*G[x]);F=(B=(3*M-(j=M-2/3*P)+R)/2)-R,H=j,rt[W=4*(D*et+C)]=d(0,u(255,i(255*B))),rt[W+1]=d(0,u(255,i(255*F))),rt[W+2]=d(0,u(255,i(255*H))),rt[W+3]=d(0,u(255,i(255*U)))}}return{w:et,h:at,rgba:rt}}(r);t||(t=a.createElement("canvas"),e=t.getContext("2d")),t.width=s.w,t.height=s.h;var h=e.createImageData(s.w,s.h);return h.data.set(s.rgba),e.putImageData(h,0,0),c[r]=t.toDataURL()}catch(t){return""}}function h(t){if(!t._th){t._th=1;var e=t.getAttribute("data-thumbhash");if(e){var a=s(e);if(a){var r=t.closest("picture")||t,n=r.style;n.backgroundImage="url("+a+")",n.backgroundSize="cover",n.backgroundPosition="center",n.backgroundRepeat="no-repeat","PICTURE"===r.tagName&&(n.display="block"),r.classList&&r.classList.add("thumbhash-loading"),t.complete&&t.naturalWidth?o():(t.addEventListener("load",o,{once:!0}),t.addEventListener("error",o,{once:!0}))}}}function o(){n.backgroundImage=n.backgroundSize=n.backgroundPosition=n.backgroundRepeat="",r.classList&&r.classList.remove("thumbhash-loading")}}function f(t){if(t&&(1===t.nodeType&&"IMG"===t.tagName&&t.hasAttribute("data-thumbhash")&&h(t),t.querySelectorAll)){var e,a=t.querySelectorAll("img[data-thumbhash]");for(e=0;e<a.length;e++)h(a[e])}}new MutationObserver(function(t){for(var e=0;e<t.length;e++)for(var a=t[e].addedNodes,r=0;r<a.length;r++)f(a[r])}).observe(a.documentElement,{childList:!0,subtree:!0}),"loading"!==a.readyState?f(a.body||a.documentElement):a.addEventListener("DOMContentLoaded",function(){f(a.body)})}();